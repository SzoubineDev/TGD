<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>The Great Debaters - Join Our Community</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  </head>
  <body class="min-h-screen flex items-center justify-center p-4 bg-gray-800">
    <div class="max-w-md w-full">
      <!-- Header -->
      <div class="text-center mb-8">
        <h1 class="text-3xl font-bold text-white mb-2">The Great Debaters</h1>
        <p class="text-gray-300">Master the Art of Persuasion</p>
      </div>

      <!-- Form Container -->
      <div class="bg-gray-700 rounded-lg shadow-xl p-8">
        <div class="text-center mb-6">
          <h2 class="text-2xl font-bold text-white mb-2">Become a Member</h2>
          <p class="text-gray-400">Join our community of critical thinkers</p>
        </div>

        <!-- Registration Form -->
        <form id="registrationForm" class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-gray-300 mb-1">Full Name *</label>
            <input
              type="text"
              id="fullName"
              class="w-full bg-gray-600 border border-gray-500 rounded px-3 py-2 text-white placeholder-gray-400 focus:outline-none focus:border-blue-500"
              placeholder="Enter your full name"
              required
            />
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-300 mb-1">Email *</label>
            <input
              type="email"
              id="email"
              class="w-full bg-gray-600 border border-gray-500 rounded px-3 py-2 text-white placeholder-gray-400 focus:outline-none focus:border-blue-500"
              placeholder="Enter your email"
              required
            />
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-300 mb-1">Phone Number *</label>
            <input
              type="tel"
              id="phone"
              class="w-full bg-gray-600 border border-gray-500 rounded px-3 py-2 text-white placeholder-gray-400 focus:outline-none focus:border-blue-500"
              placeholder="Enter your phone number"
              required
            />
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-300 mb-1">Specialty *</label>
            <select
              id="specialty"
              class="w-full bg-gray-600 border border-gray-500 rounded px-3 py-2 text-white focus:outline-none focus:border-blue-500"
              required
            >
              <option value="" disabled selected>Select your specialty</option>
              <option value="DEUST">DEUST</option>
              <option value="LICENSE">LICENSE</option>
              <option value="CYCLE D'Ingenieur">CYCLE D'Ingenieur</option>
              <option value="Master">Master</option>
              <option value="Doctorat">Doctorat</option>
            </select>
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-300 mb-1"
              >How did you hear about us? *</label
            >
            <select
              id="referralSource"
              class="w-full bg-gray-600 border border-gray-500 rounded px-3 py-2 text-white focus:outline-none focus:border-blue-500"
              required
            >
              <option value="" disabled selected>Select an option</option>
              <option value="Friend">Friend</option>
              <option value="Facebook">Facebook</option>
              <option value="Instagram">Instagram</option>
              <option value="Twitter">Twitter</option>
              <option value="LinkedIn">LinkedIn</option>
              <option value="Other">Other</option>
            </select>
          </div>

          <div id="otherSourceField" class="hidden">
            <label class="block text-sm font-medium text-gray-300 mb-1">Please specify</label>
            <input
              type="text"
              id="otherSource"
              class="w-full bg-gray-600 border border-gray-500 rounded px-3 py-2 text-white placeholder-gray-400 focus:outline-none focus:border-blue-500"
              placeholder="Please specify"
            />
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-300 mb-1">Password *</label>
            <input
              type="password"
              id="password"
              class="w-full bg-gray-600 border border-gray-500 rounded px-3 py-2 text-white placeholder-gray-400 focus:outline-none focus:border-blue-500"
              placeholder="Create a password"
              required
            />
          </div>

          <div class="flex items-center">
            <input type="checkbox" id="terms" class="mr-2" required />
            <label for="terms" class="text-sm text-gray-300">
              I agree to the Terms of Service and Privacy Policy
            </label>
          </div>

          <button
            type="submit"
            id="submitButton"
            class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 rounded transition-colors disabled:opacity-50"
          >
            Become a Member
          </button>
        </form>

        <div class="flex items-center my-6">
          <div class="flex-1 border-t border-gray-600"></div>
          <div class="px-3 text-gray-400 text-sm">OR</div>
          <div class="flex-1 border-t border-gray-600"></div>
        </div>

        <button
          id="googleSignIn"
          class="w-full bg-white hover:bg-gray-100 text-gray-700 font-medium py-2 rounded flex items-center justify-center space-x-2 border border-gray-300"
        >
          <i class="fab fa-google text-red-500"></i>
          <span>Continue with Google</span>
        </button>

        <!-- Status Message -->
        <div
          id="statusMessage"
          class="mt-4 p-3 bg-blue-900 border border-blue-700 rounded text-blue-200 text-sm text-center"
        >
          <p>✅ OAuth is configured! Google Sign-In should work now.</p>
        </div>
      </div>
    </div>

    <script>
      // Firebase Configuration
      const firebaseConfig = {
        apiKey: 'AIzaSyC6CtIlRko2CFf0owSvUlZMeVtkVDMy2BU',
        authDomain: 'the-gd-fste-ce113.firebaseapp.com',
        projectId: 'the-gd-fste-ce113',
        storageBucket: 'the-gd-fste-ce113.appspot.com',
        messagingSenderId: '485167566903',
        appId: '1:485167566903:web:9e5dfacd7e34741cf96fb2',
      };

      // Initialize Firebase
      try {
        firebase.initializeApp(firebaseConfig);
        console.log('✅ Firebase initialized successfully');
      } catch (error) {
        console.error('❌ Firebase initialization error:', error);
      }

      const auth = firebase.auth();
      const db = firebase.firestore();

      // DOM Elements
      const registrationForm = document.getElementById('registrationForm');
      const googleSignIn = document.getElementById('googleSignIn');
      const referralSource = document.getElementById('referralSource');
      const otherSourceField = document.getElementById('otherSourceField');
      const statusMessage = document.getElementById('statusMessage');

      // Show/hide other source field
      referralSource.addEventListener('change', function () {
        if (this.value === 'Other') {
          otherSourceField.classList.remove('hidden');
        } else {
          otherSourceField.classList.add('hidden');
        }
      });

      // Form Submission
      registrationForm.addEventListener('submit', async e => {
        e.preventDefault();

        const fullName = document.getElementById('fullName').value;
        const email = document.getElementById('email').value;
        const phone = document.getElementById('phone').value;
        const specialty = document.getElementById('specialty').value;
        const referralSourceValue = document.getElementById('referralSource').value;
        const otherSourceValue = document.getElementById('otherSource').value;
        const password = document.getElementById('password').value;

        const finalReferralSource =
          referralSourceValue === 'Other' ? otherSourceValue : referralSourceValue;

        if (!fullName || !email || !phone || !specialty || !referralSourceValue || !password) {
          alert('Please fill in all required fields');
          return;
        }

        const submitButton = document.getElementById('submitButton');
        submitButton.disabled = true;
        submitButton.textContent = 'Creating Account...';

        try {
          const userCredential = await auth.createUserWithEmailAndPassword(email, password);
          const user = userCredential.user;

          await db.collection('members').doc(user.uid).set({
            fullName: fullName,
            email: email,
            phone: phone,
            specialty: specialty,
            referralSource: finalReferralSource,
            createdAt: firebase.firestore.FieldValue.serverTimestamp(),
            uid: user.uid,
          });

          alert('🎉 Account created successfully! Welcome to The Great Debaters!');
          registrationForm.reset();
          otherSourceField.classList.add('hidden');
        } catch (error) {
          console.error('Registration error:', error);
          let errorMessage = 'An error occurred during registration';

          switch (error.code) {
            case 'auth/email-already-in-use':
              errorMessage = 'This email is already registered';
              break;
            case 'auth/invalid-email':
              errorMessage = 'Invalid email address';
              break;
            case 'auth/weak-password':
              errorMessage = 'Password should be at least 6 characters';
              break;
          }

          alert('❌ ' + errorMessage);
        } finally {
          submitButton.disabled = false;
          submitButton.textContent = 'Become a Member';
        }
      });

      // Google Sign In
      googleSignIn.addEventListener('click', async () => {
        const provider = new firebase.auth.GoogleAuthProvider();

        googleSignIn.disabled = true;
        googleSignIn.innerHTML =
          '<i class="fas fa-spinner fa-spin"></i><span>Connecting to Google...</span>';

        try {
          const result = await auth.signInWithPopup(provider);
          const user = result.user;

          const memberDoc = await db.collection('members').doc(user.uid).get();

          if (!memberDoc.exists) {
            await db
              .collection('members')
              .doc(user.uid)
              .set({
                fullName: user.displayName || 'Not provided',
                email: user.email,
                phone: 'Not provided',
                specialty: 'Not specified',
                referralSource: 'Google Sign-In',
                createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                uid: user.uid,
                isGoogleUser: true,
              });
            alert('🎉 Account created with Google! Welcome to The Great Debaters!');
          } else {
            alert('✅ Successfully signed in with Google! Welcome back!');
          }
        } catch (error) {
          console.error('Google sign in error:', error);

          if (error.code === 'auth/popup-closed-by-user') {
            alert('Google sign-in was cancelled');
          } else if (error.code === 'auth/unauthorized-domain') {
            statusMessage.innerHTML =
              '❌ Domain not authorized. Make sure localhost is in authorized domains.';
            statusMessage.className =
              'mt-4 p-3 bg-red-900 border border-red-700 rounded text-red-200 text-sm text-center';
          } else {
            alert('Google Sign-In error: ' + error.message);
          }
        } finally {
          googleSignIn.disabled = false;
          googleSignIn.innerHTML =
            '<i class="fab fa-google text-red-500"></i><span>Continue with Google</span>';
        }
      });
    </script>
  </body>
</html>
